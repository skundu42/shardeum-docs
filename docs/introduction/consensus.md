---
title: Transaction Consensus
sidebar_position: 4
image: /img/new/consensus.png
---

# Consensus Algorithms

### 1. Overview

Shardeum employs a unique consensus mechanism that integrates Proof of Stake (PoS) and Proof of Quorum (PoQ) to ensure secure, efficient, and scalable transaction validation. The innovative combination of these algorithms allows Shardeum to leverage the strengths of both approaches, ensuring high security through staking and efficient consensus formation through quorum-based validation.

### 2. Proof of Stake (PoS)

* **Validator Selection and Staking:** In Shardeum, validators are chosen through a deterministic lottery system, which selects active validators from the pool of staked participants. Staking involves locking up a certain amount of tokens as collateral, incentivizing validators to act honestly, as malicious behavior could lead to the loss of their staked assets. This process ensures that those with significant investments in the network have a vested interest in its integrity and performance.
* **Incentives and Penalties:** Validators earn rewards in the form of transaction fees and newly minted tokens for their participation in the consensus process. Conversely, if validators act maliciously or fail to perform their duties (e.g., by going offline), they risk losing part or all of their staked tokens. This system of rewards and penalties maintains the network's security and encourages reliable validator behavior.
* **Security and Decentralization:** By requiring validators to stake tokens, PoS reduces the risk of Sybil attacks, where an attacker could create multiple fake identities to gain control over the network. The staking requirement ensures that controlling a significant portion of the network is economically prohibitive.

### 3. Proof of Quorum (PoQ)

* **Quorum Formation:** PoQ is essential to Shardeumâ€™s consensus process, particularly within its sharded architecture. A quorum is formed when a predefined number of validators in a shard agree on the validity of a transaction. This consensus model is efficient because it reduces the amount of communication required among validators, which is crucial for scalability. PoQ leverages large shards, allowing the network to achieve consensus without requiring all validators to communicate with each other. Instead, only a subset of validators needs to interact, significantly reducing the communication overhead.
* **Efficient Data Exchange:** In the PoQ system, validators perform a process known as "data healing" to maintain consensus. This involves validators exchanging data hashes and repairing discrepancies by requesting and validating missing or incorrect data from their peers.
  * **Data Structure and Prefix Tree:** The data healing system utilizes a sharded hash tree structure, where each node only has a portion of this tree. Any nodes only cover a certain portion of it. Validators share intermediate hashes of their data to maintain consensus.
  * **Hash Discrepancies:** When validators encounter hash discrepancies, they engage in a systematic process to identify and rectify these differences. For example, if a validator's data does not match the consensus, it requests the missing data from other validators and verifies it against the hashes to ensure integrity.
  * **Efficiency and Parallel Processing:** The data healing mechanism is highly efficient due to its parallel processing capabilities. Validators can handle multiple discrepancies simultaneously by working on batches of data. For instance, if discrepancies are found at multiple points in the tree, validators can address them concurrently, significantly speeding up the repair process. **Example:** Consider a scenario where a validator detects discrepancies in multiple parts of its data tree. Instead of addressing each discrepancy sequentially, the validator can request and process data for all the problematic sections simultaneously. This parallel approach allows the validator to correct issues faster, ensuring the network remains consistent and reducing downtime.
  * **Step-by-Step Repair Process:** When discrepancies are detected, validators request the next level of hashes from their peers: "Okay, out of these 16, one hash does not match. Give me the next 16." This continues down to the leaf nodes, which contain arrays of accounts. Finally, the validator pinpoints the exact mismatched accounts, requests them, and updates its local state, ensuring consistency across the network.
  * **Scalability:** The sharded hash tree structure and the efficient data exchange process ensure that the system remains scalable. Even as the network grows, the workload is distributed evenly among validators, preventing any single node from becoming a bottleneck.
  * **Timestamp Gating:** The data considered for healing is closely gated based on timestamps. This ensures that the healing process deals with the most recent and relevant data, maintaining the accuracy and integrity of the network's state. **Example:** Suppose a validator processes transactions continuously and encounters data discrepancies at different times. By gating data based on timestamps, the validator ensures that it only addresses discrepancies within the same timeframe, avoiding conflicts with more recent or older transactions. This approach helps maintain a coherent state across the network, even as new data is constantly being processed.
* **Transaction Validation:** Validators in a quorum cryptographically sign off on transactions. When enough validators (i.e., a quorum) have validated a transaction, it is considered confirmed and added to the blockchain. This method significantly enhances the speed and efficiency of transaction validation in a sharded network. Validators share votes within their group, and the votes are aggregated to form a consensus. If the majority of the validators within the quorum agree on the transaction, it is confirmed. This process reduces the need for extensive communication among all validators, allowing for quicker consensus formation.
* **Communication Efficiency:** The PoQ model minimizes the need for extensive communication among validators. Instead of all validators communicating with each other, which can become a bottleneck, the PoQ approach streamlines this process, significantly enhancing scalability. In previous consensus models, each validator in the execution group would make a vote and share it with all other nodes, which became impractical as the number of validators increased. PoQ reduces this communication overhead by limiting the interactions to a subset of validators, thus maintaining efficiency even with a large number of nodes.
* **Dynamic Adjustment:** The PoQ system dynamically adjusts to the number of validators, maintaining efficiency even as the network grows. This flexibility is crucial for ensuring that the network remains scalable and performant as it evolves. The consensus mechanism adapts to changes in the network, such as nodes joining or leaving. This dynamic adjustment ensures that the network continues to function efficiently without requiring significant manual intervention or reconfiguration.

<!-- ![Consensus](/img/new/consensus.png) -->


<iframe width="800" height="480" src="https://www.youtube.com/embed/uFX6TY55XwM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
